---
import { getDoubanMusic, type MusicItem } from '@/api/get-douban-music'
import Cover from '@/components/Cover'
import PlayButton from '@/components/PlayButton'
import TrackList from '@/components/TrackList'
import Layout from '@/layouts/Layout.astro'

const { id } = Astro.params

export async function getStaticPaths() {
	const musicList = await getDoubanMusic()
	return musicList.map((musicItem) => ({
		params: { id: musicItem.id },
		props: musicItem
	}))
}

const {
	songName,
	songImgHref,
	// songDoubanHref,
	songArtist,
	songYear,
	songAlbumType,
	songMedium,
	songStyle,
	songItemList
} = Astro.props as MusicItem

const playList = songItemList.map((item) => ({
	albumId: id,
	index: item.id,
	songArtist,
	songName: item.name,
	songImgHref,
	mp3Url: item.mp3Url
}))
---

<Layout title={`${songName} - ${songArtist} - Douban Music`}>
	<section>
		<div
			class="container mx-auto flex max-w-screen-lg flex-col items-center gap-6 px-6 pb-12 pt-8 md:flex-row md:items-start lg:px-0"
		>
			<Cover
				albumId={id}
				songArtist={songArtist}
				songImgHref={songImgHref}
				songName={songName}
				client:visible
			/>
			<div class="flex flex-1 flex-col justify-end gap-6">
				<div class="text-4xl font-bold tracking-tight">{songName}</div>
				<div class="text-3xl">{songArtist}</div>
				<div class="text-lg text-gray-700">
					{songYear}
				</div>
				<div class="text-lg text-gray-700">
					{songAlbumType}
				</div>
				<div class="text-lg text-gray-700">
					{songMedium}
				</div>
				<div class="text-lg text-gray-700">
					{songStyle}
				</div>
				<div class="mt-3">
					<PlayButton playList={playList} client:load />
				</div>
			</div>
		</div>
		<div class="container mx-auto mb-10 max-w-screen-lg px-6 lg:px-0">
			<h2 class="py-2 text-2xl font-bold">歌曲列表</h2>
			<div class="flex flex-col gap-2">
				{
					songItemList.map((item) => (
						<TrackList playList={playList} index={item.id} client:visible />
					))
				}
			</div>
		</div>
	</section>
</Layout>
